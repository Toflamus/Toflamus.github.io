<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Free energy, from histogram method and bias sampling to MBAR | Toflamus W. </title> <meta name="author" content="Toflamus W."> <meta name="description" content="This post mainly focuses on the histogram method for free energy calculation on reaction coordinate (order parameter) by MD. Starting from biased sampling to umbrella sampling till the advanced multistate data processing method(Multistate Bennett Acceptance ratio, MBAR)."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://toflamus.github.io/assets/blogplans/2024-07-15-umbrellasampling/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Free energy, from histogram method and bias sampling to MBAR",
            "description": "This post mainly focuses on the histogram method for free energy calculation on reaction coordinate (order parameter) by MD. Starting from biased sampling to umbrella sampling till the advanced multistate data processing method(Multistate Bennett Acceptance ratio, MBAR).",
            "published": "July 15, 2024",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Toflamus</span> W. </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Free energy, from histogram method and bias sampling to MBAR</h1> <p>This post mainly focuses on the histogram method for free energy calculation on reaction coordinate (order parameter) by MD. Starting from biased sampling to umbrella sampling till the advanced multistate data processing method(Multistate Bennett Acceptance ratio, MBAR).</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#general-overview">General overview</a> </div> <div> <a href="#introduction-of-histogram-method-from-overlapping-distribution-method-to-free-energy-perturbation-fep-expression">Introduction of histogram method, from overlapping-distribution method to free energy perturbation(FEP) expression</a> </div> <div> <a href="#"></a> </div> <ul> <li> <a href="#the-core-of-histogram-method">The core of histogram method</a> </li> </ul> <div> <a href="#"></a> </div> <div> <a href="#"></a> </div> </nav> </d-contents> <h2 id="general-overview">General overview</h2> <p>This is an overview and recap from the book of Frenkel and Daan.<d-cite key="undMD"></d-cite></p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets%5Cimg%5C2024-07-14-umbrellasampling%5CFree_energy_computation-480.webp 480w,/assets%5Cimg%5C2024-07-14-umbrellasampling%5CFree_energy_computation-800.webp 800w,/assets%5Cimg%5C2024-07-14-umbrellasampling%5CFree_energy_computation-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets%5Cimg%5C2024-07-14-umbrellasampling%5CFree_energy_computation.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>This figure demostrates 2 main ways of computation of free energy. The first one is thermodynamic integration(TI), the second one is the Histogram method.</p> <p>The TI method is easy to understand, people who did <em>Physical Chemistry</em> are good at establish an imaginary reversible route from state $1$ to state $2$. Since the free energy is a state property, it can be easily calculate by integration from one state to another state. However, in the textbook<d-cite key="undMD"></d-cite> the TI method only concerns Canonical ensemble and another newly published paper<d-cite key="jinnouchi_machine_2024"></d-cite> is attached for grand canonical ensemble.</p> <p>Here, we mainly focus on the Histogram method and bias sampling, while <em>Wang-Landau</em> style algorithm and <em>Density of state</em> approximation<d-cite key="wang-landau00"></d-cite> are not covered. Meanwhile, Bennett Acceptance Ratio method, the basis of MBAR, are excluded from this blog, because the derivation takes me 4 pages of paper.</p> <h2 id="introduction-of-histogram-method-from-overlapping-distribution-method-to-free-energy-perturbationfep-expression">Introduction of histogram method, from overlapping-distribution method to free energy perturbation(FEP) expression</h2> <p>For convenience, only canonical ensemble, ($N,V,T$) systems, are discussed here. $F$ denotes Helmholtz free energy.</p> <h3 id="the-core-of-histogram-method">The core of histogram method</h3> <blockquote> <p>First thing frist, people only cares about the free energy difference.<br> \(\Delta F = -\frac{1}{\beta}\ln(Q_1/Q_0)\)</p> </blockquote> <p>Every thing we do is to estimate $Q_1/Q_0$</p> <p><strong><em>Notices</em></strong>:</p> <ul> <li>If we want to compare the free energy difference, the 2 systems should have the same setting, such as the same atom types and number, but not necessarily the potential operator $\mathcal{U}(\mathbf{r}^ N)$. As a result, in a infinite long sampling, that can have identical configurations that overlap each other. This is where histogram is from.<d-footnote>You will understand what I am saying after reading the Overlapping distribution method part</d-footnote>. However, one may think that the free energy can be compared among totally different systems as long as they have the same reference,such as water and carbon with standard $H$ and $S$ reference. However, we can consider a reversible transition process which transfer the 2 systems to a imaginary system with same settings<d-footnote>You may prefer to transfer a system to another,more specifically, transfering a type of atom to another, adding atoms, expanding the volumes. There must be some reversible pathway to do this</d-footnote>. This process can be calculate with thermo-integration(TI) method. So the key problem is the partition function ratio of 2 systems of same or overlapping <a href="https://en.wikipedia.org/wiki/Configuration_space_(physics)" rel="external nofollow noopener" target="_blank">configurational space</a>.</li> <li>The distribution of configuration, normally<d-footnote>If we do not consider the commutor $\mathcal{O}[\mathcal{K}, \mathcal{U}]$</d-footnote>, is not influenced by temperature, as temperature only represent the momentum, while $\mathcal{U}(\mathbf{r}^N)$ is a function of the coordinate $\mathbf{r}^N$.</li> </ul> <h3 id="overlapping-distribution-method">Overlapping distribution method</h3> <p>Starting from the core of histogram method:</p> \[\Delta F = -\frac{1}{\beta}\ln(Q_1/Q_0)\] <p>Using the configurational partition expression to replace $Q$:</p> \[\Delta F = -\frac{1}{\beta}\ln\left(\frac{\int d \chi exp[-\beta \mathcal{U_1}(\chi)]}{\int d \chi exp[-\beta \mathcal{U_0}(\chi)]}\right)\] <p>Suppose we have 2 systems with same configurational space, by which I mean the atom types, atom number, volume of the system are the same and the atom coordinate in these 2 system are able to have the same value<d-footnote>They may not necessarily have the same force field or potential operator</d-footnote>. If we have a infinite long sampling with a really good algorithm that can sample every state with correct probability. Then the configurational space are fully searched with accuracy. As a result, the 2 system must have some configuration that are the same but have different probability of visiting this configuration.</p> <p>In other words, for every configuration visited during this sampling of system $1$ we can compute the potential energy of system $0$ for the same configuration $\mathbf{s}^N$. The potential energy difference of the same configuratio in 2 systems are: $\Delta\mathcal{U}(\mathbf{s}^N) = \mathcal{U_1}(\mathbf{s})^N-\mathcal{U_0}(\mathbf{s})^N$. We use this information to construct a histogram that measures the probability density by $p_1(\Delta\mathcal{U})$:</p> \[p_1(\Delta\mathcal{U}) = \frac{\int d\chi}{}\] </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-07-14-umbrellasampling.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2024 Toflamus W.. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>