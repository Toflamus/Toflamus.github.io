<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Hysteresis voltage modeling | Toflamus W. </title> <meta name="author" content="Toflamus W."> <meta name="description" content="Simple introduce hysteresis voltage and its phenomenological modeling"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://toflamus.github.io/blog/2024/Hysteresis-voltage/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Hysteresis voltage modeling",
            "description": "Simple introduce hysteresis voltage and its phenomenological modeling",
            "published": "April 27, 2024",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Toflamus</span> W. </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Hysteresis voltage modeling</h1> <p>Simple introduce hysteresis voltage and its phenomenological modeling</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#hysteresis-voltage">Hysteresis voltage</a> </div> <div> <a href="#main-loop-and-minor-loop">Main loop and minor loop</a> </div> <div> <a href="#hysteresis-modeling">Hysteresis modeling</a> </div> <div> <a href="#enhanced-self-correcting-esc-model">Enhanced self-correcting (ESC) model</a> </div> <div> <a href="#"></a> </div> <ul> <li> <a href="#single-resistor-and-capacitor-pair">Single resistor-and-capacitor pair</a> </li> <li> <a href="#esc-model-and-its-state-equation">ESC model and its *state equation*</a> </li> </ul> </nav> </d-contents> <h2 id="hysteresis-voltage">Hysteresis voltage</h2> <p>Definition: OCV-SOC curves for charging and discharging Li-ion batteries do not overlap. The difference between the curves is defined as <em>Hysteresis voltage</em>.</p> <p>The modeling can be physics-based or phenomenon-based.</p> <p>I find the modeling of hysteresis is a deep field because the hysteresis phenomenon can happen in various disciplines. There is even a book about hysteresis modeling<d-cite key="hysteresismodelingmath"></d-cite>. There are plenty of different models to model a hysteresis, such as Prandtl-Ishlinskii hysteresis model<d-cite key="4739202"></d-cite>(This is a topic in control engineering). However, they are not covered in this blog post. I just put them here for further reference. The main framework is still from L. Plett’s book.<d-cite key="BMS_vol1"></d-cite></p> <h2 id="main-loop-and-minor-loop">Main loop and minor loop</h2> <p>This part is mainly from the Guillaume Larrat’s thesis. <d-cite key="Lihysteresismodeling"></d-cite></p> <p>The charging and discharging OCV curves that were displayed in the figure below allows to create a voltage hysteresis loop for a SOC varying from 0% to 100% which includes the whole range of possible values for the SOC.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/OCV_curve-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/OCV_curve-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/OCV_curve-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/OCV_curve.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>It is composed of the two <strong>major</strong> OCV curves: a charge from 0% to 100% SOC and a full discharge from 100% to 0%. The corresponding voltage hysteresis loop is then called a major loop. However, if the cell is partially charged or discharged from a state different than 0% or 100%, the OCV will not follow the two curves displayed earlier. If a cell is at a 60% SOC and is then discharged to 40% and then charged back to 60%, this will create a minor loop as shown in Figure below:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/major_minor_loop-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/major_minor_loop-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/major_minor_loop-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/major_minor_loop.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Assupmtion: The loop of a real-time charge/discharge process only locates insides the major loop. Apparently, the changing rate in a minor loop is different from the major loop.</p> <h2 id="hysteresis-modeling">Hysteresis modeling</h2> <p>Let’s just build a simple model:<br> Assumptions:</p> <ul> <li>Linear: The changing rate of hysteresis voltage only depends the difference between maxium OCV and current OCV.</li> <li>Past path invariant: The hyseresis does not depend on how to get to the state but just and past state themselves. Actually, this is not true.</li> </ul> <p>\(h(z(t)) = OCV_{charge}(z(t))-OCV_{discharge}(z(t))\) \(\frac{dh(z,t)}{dz} = \gamma sgn(\dot z)(M(z,\dot z)- h(z,t))\)</p> <p>$\gamma$ is just a coefficient for linear approximation.<br> $M(z,\dot z)$: A function that gives the maximum polarization due to the hysteresis as a function of SOC and rate of charge.<br> $M(z,\dot z)- h(z,t)$: Indicates that the rate of change of the hysteresis voltage is proportional to the distance of the current hysteresis value from the main hysteresis loop. In other words, the driving force decides the rate of change.<br> $z(t)$ defines the changing direction of the hysteresis. For charging process, $\dot z &gt; 0$, which means hysteresis tends to be larger, this means the $$OCV_{charge}(z(t))$ tends to be closer to the maximum OCV.</p> <p>Because our previous equivalent circuit model depends on the time, we use the chain rule to make the differencial equation a function of time.</p> \[\frac{dh(z,t)}{dz} \frac{dz}{dt} = \gamma sgn(\dot z)(M(z,\dot z)- h(z,t)) \frac{dz}{dt}\] <p>\(\frac{dz}{dt} = -\eta(t)i(t)/Q\) $\dot z sgn(\dot z) = |z|$</p> \[\frac{dh(z,t)}{dz} \frac{dz}{dt} = \gamma (M(z,\dot z)- h(z,t)) *|\frac{\eta(t)i(t)}{Q}|\] <p>To make life easier <strong>assume $I(t)$ &amp; $M(z,\dot z)$ are constant during sampling period</strong>. So if one want to get the fully profile, multiple linear approximation can be made to tackle this problem.</p> <p>Solve the ODE and make it discrete, and do some rearrangements:</p> \[h[s+1] = exp(-|\frac{\eta[s]I\Delta t\gamma}{Q}|)h[s] + M(z,\dot z)(1-exp(-|\frac{\eta[s]I\Delta t\gamma}{Q}|))\] <p>Note: $M(z,\dot z) $ varies with current orientation, the simplest way to make it a const is by $M(z,\dot z) = -M sgn(i(t))$</p> <p>Now the equation becomes:</p> \[h[s+1] = exp(-|\frac{\eta[s]I\Delta t\gamma}{Q}|)h[s] - Msgn(i(t))(1-exp(-|\frac{\eta[s]I\Delta t\gamma}{Q}|))\] <table> <tbody> <tr> <td>$A_H[s] = exp(-</td> <td>\frac{\eta[s]I\Delta t\gamma}{Q}</td> <td>)$</td> </tr> </tbody> </table> <p>\(h[s+1] = A_H h[s] - Msgn(i(t))(1-A_H)\)</p> <h2 id="enhanced-self-correcting-esc-model">Enhanced self-correcting (ESC) model</h2> <p><em>Enhanced</em> means the model also includes hysteresis effects.<br> <em>Self-correcting</em> means the model converges to the $OCV+hysteresis$ when $i = 0$</p> <p>From the discussion on equivalant circuit models, now with new information with hysteresis effects. The OCV with half cell equivalent circuit can be viewed as follows:</p> <div class="row mt-3"> <div class="col-sm mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/circuit1-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/circuit1-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/circuit1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/circuit1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> half-cell with OCV and hysteresis </div> <p>When the time scale difference bewteen Warburg impedance and other circuit elements are so large, that the Warburg impedance get out on to the main branch.</p> <div class="row mt-3"> <div class="col-sm mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/circuit2-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/circuit2-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/circuit2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/circuit2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> approximation of half-cell with OCV and hysteresis. </div> <p>As we have discussed in another blog the linear part of Warburg impedance can be approximated by a series of parallel resistor-and-capacitor pairs.</p> <div class="row mt-3"> <div class="col-sm mt-4 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/circuit3-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/circuit3-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/circuit3-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/circuit3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Let’s denote the charge transfer resistance and double layer capacity as $R_{0}$ and $C_{0}$</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-04-27-Hysteresis-voltage/circuit4-480.webp 480w,/assets/img/2024-04-27-Hysteresis-voltage/circuit4-800.webp 800w,/assets/img/2024-04-27-Hysteresis-voltage/circuit4-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2024-04-27-Hysteresis-voltage/circuit4.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="single-resistor-and-capacitor-pair">Single resistor-and-capacitor pair</h3> <p>Let’s use the current to analyze a resistor-and-capacitor pair.</p> <p>For a single pair, use the voltage change of a single resistor-and-capacitor pair as a birdge:</p> <p>\(u_k = \frac{Q_k}{C_k} = \frac{1}{C_k}\int_0^t I-i_k dt\) \(u_k = R_k i_k\)</p> <p>where $i_k$ is the current goes through $R_k$ and I is main branch current.</p> <p>After take a derivative and rearrangement:</p> \[i_k(t) + \frac{i(t)}{C_kR_k} = \frac{I(t)}{C_kR_k}\] <p>Solve the ODE using Cauchy’s method.</p> \[i_k(t) = Ae^{-\frac{t}{C_kR_k}} + i_c(t)\] <p>When in reality, the I(t) can be AC current such as in the case of (EIS). So it can be extended to a fourier series. This means the solution of the ODE is also a fourier series, denoted $i_c(t) = I’(t)$.</p> <p>Now let’s think about the discret form.</p> <p>\(i_k[s] = Ae^{-\frac{s\Delta t}{C_kR_k}} + i_c[s]\) \(i_k[s+1] = Ae^{-\frac{(s+1)\Delta t}{C_kR_k}} + i_c[s+1]\)</p> <p>Then:</p> <p>\(i_k[s+1] = F_k * i_k[s] + i_c[s+1] - F_k i_c[s]\) \(F_k = e^{-\frac{\Delta t}{C_kR_k}}\)</p> <p>To make life easier <strong>assume I(t) is a constant during sample period</strong>. So if one want to get the fully profile, multiple linear approximation can be made to tackle this problem.</p> \[i_c[s] = i_c[s+1] = I\] <p>The original solution becomes:<br> \(i_k[s+1] = F_k * i_k[s] + (1- F_k)I\)</p> <p>Convert this equation to a matrix form:</p> <p>\(\vec i_r[s+1] = \mathbb A_{RC} * \vec i_r[s] + b_{RC} I\) \(\mathbb A_{RC} = diag(F_k)\) \([\vec b_{RC}]_i = 1-F_i\)</p> <h3 id="esc-model-and-its-state-equation">ESC model and its <em>state equation</em> </h3> <p>Combine everything above together, we get the <em>state equation</em> of ESC model [ \begin{bmatrix} z[s+1]<br> \vec i_r[s+1]<br> h[s+1]<br> \end{bmatrix} = \begin{bmatrix} 1 &amp; 0 &amp; 0<br> 0 &amp; \mathbb A_{RC} &amp; 0 <br> 0 &amp; 0 &amp; A_H<br> \end{bmatrix} \begin{bmatrix} z[s]<br> \vec i_r[s]<br> h[s]<br> \end{bmatrix} + \begin{bmatrix} -\frac{\eta [s] \Delta t}{Q} &amp; 0<br> \vec b_{RC} &amp; 0<br> 0 &amp; A_H-1 \end{bmatrix} \begin{bmatrix} I &amp; sgn(I)<br> \end{bmatrix} ]</p> <h2 id="afterwords">Afterwords</h2> <h3 id="soc-method-to-analysis-the-circuit">SOC method to analysis the circuit</h3> <p>When considering the voltage of each resistor-and-capacitor pair,the ODE for a single resistor-and-capacitor pair is:</p> \[\dot u_i = -\frac{1}{R_i C_i} u_i + \frac{1}{C_i} I\] <p>The ODEs for resistor-and-capacitor pairs can be expressed as:</p> <p>\begin{equation} \begin{bmatrix} \dot u_0<br> \dot u_1<br> \vdots<br> \dot u_n<br> \end{bmatrix} = \begin{bmatrix} -\frac{1}{C_0R_0} &amp; 0 &amp; \cdots &amp; 0 <br> 0 &amp; -\frac{1}{C_1R_1} &amp; \cdots &amp; 0 <br> \vdots &amp; 0 &amp; \cdots &amp; 0 <br> 0 &amp; \cdots &amp; 0 &amp; -\frac{1}{C_nR_n}<br> \end{bmatrix} \begin{bmatrix} u_0<br> u_1<br> \vdots<br> u_n<br> \end{bmatrix} + \begin{bmatrix} \frac{1}{C_0}<br> \frac{1}{C_1}<br> \vdots<br> \frac{1}{C_n}<br> \end{bmatrix} I \end{equation} This is the method with voltage to describe the SOC but however I need to use current instead of voltage to analyze the circuit here.</p> <p>I did not heard about this topic too much before when I concentrated at ElectroChemistry. The hysteresis effect is important for Battery Management Systems.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-04-27-Hysteresis-voltage.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Toflamus W.. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>